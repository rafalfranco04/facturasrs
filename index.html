<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Pedido</title>

<style>
body{
font-family: Arial, sans-serif;
background: #f2f2f2;
display:flex;
justify-content:center;
align-items:center;
min-height:100vh;
margin:0;
}

.container{
background:white;
padding:60px;
border-radius:15px;
box-shadow:0 5px 20px rgba(0,0,0,0.2);
width:90%;
max-width:420px;
}

h2{text-align:center;}

input, select{
width:100%;
padding:14px;
margin-top:10px;
border-radius:10px;
border:1px solid #ccc;
font-size:16px;
}

.product-row{
margin-top:10px;
padding:20px;
border:1px dashed #ccc;
border-radius:10px;
}

.subtotal{
font-size:14px;
margin-top:5px;
}

button{
width:100%;
padding:15px;
margin-top:15px;
background:#25D366;
color:white;
border:none;
border-radius:10px;
font-size:18px;
cursor:pointer;
}

button:hover{background:#1ebe5d;}
.add-product{background:#007bff;}

.success{
position:fixed;
top:0;
left:0;
width:100%;
height:100%;
background:#25D366;
display:flex;
flex-direction:column;
justify-content:center;
align-items:center;
color:white;
font-size:22px;
opacity:0;
pointer-events:none;
transition:0.5s;
}

.success.show{
opacity:1;
pointer-events:all;
}

.check{
font-size:80px;
}
</style>
</head>

<body>

<div class="container">

<h2>Formulario de Pedido</h2>

<form id="pedidoForm">

<input type="text" id="pedidoNumero" placeholder="NÃºmero de pedido" required>
<input type="text" id="nombre" placeholder="Nombre del cliente" required>
<input type="text" id="ubicacion" placeholder="UbicaciÃ³n" required>

<select id="tipoPago" required>
<option value="">Tipo de pago</option>
<option>Contado</option>
<option>CrÃ©dito</option>
</select>

<select id="repartidor" required>
<option value="">Seleccionar repartidor</option>
<option value="maiquel">Maiquel</option>
<option value="roberto">Roberto</option>
<option value="ricaedo">Ricaedo</option>
<option value="mole">Mole</option>
<option value="rafael">Rafael</option>
<option value="dimitri">Dimitri</option>
</select>

<h3>Productos</h3>
<div id="productos"></div>

<button type="button" class="add-product" onclick="agregarProducto()">
âž• AÃ±adir Producto
</button>

<input type="number" step="0.01" id="envio" placeholder="Costo de envÃ­o" oninput="calcularTotal()">
<input type="number" step="0.01" id="total" placeholder="Total" readonly>

<input type="date" id="fecha" required>
<input type="time" id="hora" required>
<input type="tel" id="telefono" placeholder="NÃºmero de telÃ©fono" required>

<button type="submit">Pagar / Enviar Pedido</button>

</form>
</div>

<div class="success" id="successScreen">
<div class="check">âœ”</div>
<p>Su pedido ha sido enviado</p>
</div>

<script>

const repartidores = {
maiquel: {numero:"50764058540", nombre:"Maiquel"},
roberto: {numero:"50762792239", nombre:"Roberto"},
ricardo: {numero:"50764285441", nombre:"Ricaedo"},
mole: {numero:"50769130640", nombre:"Mole"},
rafael: {numero:"50762980868", nombre:"Rafael"},
dimitri: {numero:"50763301770", nombre:"Dimitri"}
};

function agregarProducto(){
let contenedor = document.getElementById("productos");

let div = document.createElement("div");
div.classList.add("product-row");

div.innerHTML = `
<input type="text" placeholder="Nombre del producto" class="producto-nombre" required>
<input type="number" placeholder="Cantidad" class="producto-cantidad" min="1" value="1" oninput="calcularTotal()" required>
<input type="number" step="0.01" placeholder="Precio unitario" class="producto-precio" oninput="calcularTotal()" required>
<div class="subtotal">Subtotal: $0.00</div>
`;

contenedor.appendChild(div);
}

function calcularTotal(){

let total = 0;
let envio = parseFloat(document.getElementById("envio").value) || 0;

document.querySelectorAll(".product-row").forEach(row=>{

let cantidad = parseFloat(row.querySelector(".producto-cantidad").value) || 0;
let precio = parseFloat(row.querySelector(".producto-precio").value) || 0;

let subtotal = cantidad * precio;

row.querySelector(".subtotal").innerText = `Subtotal: $${subtotal.toFixed(2)}`;

total += subtotal;

});

total += envio;
document.getElementById("total").value = total.toFixed(2);
}

function imprimirTicket(mensaje){

let ventana = window.open('', 'PRINT', 'height=600,width=400');

ventana.document.write(`<pre style="font-family: monospace;">${mensaje}</pre>`);

ventana.document.close();
ventana.print();
ventana.close();
}

document.getElementById("pedidoForm").addEventListener("submit", function(e){

e.preventDefault();

let repartidorKey = document.getElementById("repartidor").value;
let repartidorData = repartidores[repartidorKey];

let numeroRepartidor = repartidorData.numero;
let nombreRepartidor = repartidorData.nombre;

let pedidoNumero = document.getElementById("pedidoNumero").value;
let nombre = document.getElementById("nombre").value;
let ubicacion = document.getElementById("ubicacion").value;
let tipoPago = document.getElementById("tipoPago").value;
let fecha = document.getElementById("fecha").value;
let hora = document.getElementById("hora").value;
let telefono = document.getElementById("telefono").value;
let total = document.getElementById("total").value;
let envio = document.getElementById("envio").value || 0;

let productosTexto = "";

document.querySelectorAll(".product-row").forEach(row=>{
let nombreProd = row.querySelector(".producto-nombre").value;
let cantidad = row.querySelector(".producto-cantidad").value;
let precio = row.querySelector(".producto-precio").value;

productosTexto += `â€¢ ${nombreProd} (x${cantidad}) - $${precio}\n`;
});

let mensajeFactura = `
****************************************
               ROBERT SHOP
            FACTURA NO FISCAL
****************************************     

â—‰ Pedido #: ${pedidoNumero}

â—‰ Fecha: ${fecha}
â—‰ Hora: ${hora}

â—‰ Cliente: ${nombre}
â—‰ UbicaciÃ³n: ${ubicacion}
â—‰ TelÃ©fono: ${telefono}
â—‰ Pago: ${tipoPago}
â—‰ Repartidor: ${nombreRepartidor}

â—‰ Productos:
${productosTexto}

â—‰ EnvÃ­o: $${envio}
â—‰ Total: $${total}
****************************************
GRACIAS POR SU COMPRA

Realizar tu pedidos al: 6279-2239

Buscarnos en el directorio de 
Yappy como: ROBERT SHOP
`;

let mensajeRepartidor = `
â—‰ NUEVO PEDIDO â—‰ 

â—‰ Pedido #: ${pedidoNumero}
â—‰ Cliente: ${nombre}
â—‰ UbicaciÃ³n: ${ubicacion}
â—‰ TelÃ©fono: ${telefono}

â—‰ Productos:
${productosTexto}

â—‰ Pago: ${tipoPago}
â—‰ Total: $${total}
`;

let urlRepartidor = `https://wa.me/${numeroRepartidor}?text=${encodeURIComponent(mensajeRepartidor)}`;

document.getElementById("successScreen").classList.add("show");

imprimirTicket(mensajeFactura);

setTimeout(()=>{
window.open(urlRepartidor, "_blank");
},1500);


// ðŸ”¥ RESETEAR FORMULARIO AUTOMATICO
setTimeout(()=>{

document.getElementById("pedidoForm").reset();
document.getElementById("productos").innerHTML = "";
agregarProducto();
calcularTotal();

document.getElementById("successScreen").classList.remove("show");

},4000);

});

document.addEventListener("DOMContentLoaded", agregarProducto);

</script>

</body>
</html>

